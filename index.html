<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevTask - Pro UI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        /* --- THEME: NORD --- */
        :root { --bg-body: #2e3440; --bg-card: #3b4252; --bg-input: #434c5e; --text-main: #d8dee9; --text-muted: #94a3b8; --accent-primary: #88c0d0; --accent-secondary: #ebcb8b; --accent-danger: #bf616a; --accent-success: #a3be8c; --accent-purple: #b48ead; --border-radius: 8px; --border-color: #4c566a; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg-body); color: var(--text-main); height: 100vh; display: flex; justify-content: center; align-items: center; padding: 2rem; overflow: hidden; }
        
        /* OVERLAYS */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(46, 52, 64, 0.95); backdrop-filter: blur(8px); z-index: 9999; display: flex; justify-content: center; align-items: center; padding: 20px; animation: fadeIn 0.2s ease; }
        .modal-box { background: var(--bg-card); border: 1px solid var(--border-color); padding: 30px; width: 100%; max-width: 380px; border-radius: 12px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.4); position: relative; animation: slideUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .modal-title { font-size: 1.3rem; font-weight: 700; margin-bottom: 8px; color: var(--accent-primary); }
        .modal-sub { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 25px; line-height: 1.4; }
        .close-modal { position: absolute; top: 15px; right: 15px; background: transparent; border: none; color: var(--text-muted); cursor: pointer; font-size: 1.2rem; }
        
        .btn-row { display: flex; gap: 10px; justify-content: center; margin-top: 10px; }
        .modal-btn { padding: 10px 20px; border-radius: 6px; border: none; font-weight: 600; cursor: pointer; transition: 0.2s; flex: 1; }
        .btn-primary { background: var(--accent-primary); color: #2e3440; }
        .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-danger { background: var(--accent-danger); color: #fff; }
        .btn-danger:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-secondary { background: var(--bg-input); color: var(--text-main); }
        .btn-secondary:hover { background: #4c566a; }

        /* LAYOUT */
        .app-container { display: grid; grid-template-columns: 320px 1fr; gap: 30px; width: 100%; max-width: 1100px; height: 85vh; opacity: 0; transition: opacity 0.5s ease; }
        @media (max-width: 900px) {
            .app-container { grid-template-columns: 1fr; height: 100%; display: flex; flex-direction: column; overflow-y: auto; padding-bottom: 20px; }
            body { height: auto; overflow: auto; padding: 10px; }
            .quick-box, .scheduled-box { flex: none !important; height: 300px !important; }
            .dev-footer { margin-top: 20px; padding-bottom: 20px; }
        }

        .dev-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .sidebar { display: flex; flex-direction: column; flex-shrink: 0; }
        .user-section { margin-bottom: 35px; }
        .greeting-row { display: flex; align-items: center; justify-content: space-between; gap: 6px; font-size: 1.2rem; position: relative; }
        
        /* --- 1. NEW STYLISH GRADIENT NAME --- */
        .user-name {
            font-weight: 800;
            font-size: 1.4rem;
            /* Gradient: Frost Blue to Soft Purple */
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0px 2px 10px rgba(136, 192, 208, 0.2); /* Subtle Glow */
        }
        
        .menu-btn { background: transparent; border: none; color: var(--text-muted); font-size: 1.5rem; cursor: pointer; padding: 4px; border-radius: 4px; transition: 0.2s; }
        .menu-btn:hover, .menu-btn.active { color: var(--accent-primary); background: rgba(255,255,255,0.05); }
        .dropdown-menu { position: absolute; top: 100%; right: 0; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 8px; width: 200px; display: none; flex-direction: column; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 100; overflow: hidden; animation: slideDown 0.2s ease; }
        .dropdown-menu.show { display: flex; }
        .menu-item { padding: 12px 15px; text-align: left; background: transparent; border: none; color: var(--text-main); font-size: 0.9rem; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: 0.2s; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .menu-item:hover { background: rgba(255,255,255,0.05); color: white; }
        .menu-item:last-child { border-bottom: none; color: var(--accent-danger); }
        .menu-item:last-child:hover { background: rgba(191, 97, 106, 0.1); }

        /* --- 2. TYPEWRITER EFFECT --- */
        .welcome-sub {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 4px;
            font-family: 'JetBrains Mono', monospace;
            overflow: hidden; /* Ensures content is not revealed until animation */
            border-right: 3px solid var(--accent-secondary); /* The blinking cursor */
            white-space: nowrap; /* Keeps content on one line */
            margin: 0;
            width: 0; /* Start width 0 */
            animation: 
                typing 2s steps(20, end) forwards,
                blink-caret 0.75s step-end infinite;
        }

        /* Typewriter Animations */
        @keyframes typing {
            from { width: 0 }
            to { width: 145px; } /* Adjust based on text length */
        }
        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: var(--accent-secondary) }
        }

        /* REST OF CSS */
        .toggle-group { display: flex; gap: 10px; margin-bottom: 25px; margin-top: 10px; }
        .type-btn { flex: 1; padding: 10px; background: transparent; border: 2px solid var(--border-color); color: var(--text-muted); border-radius: var(--border-radius); cursor: pointer; font-weight: 500; transition: 0.2s; }
        .type-btn.active { border-color: var(--accent-primary); color: var(--accent-primary); background: rgba(136, 192, 208, 0.1); }
        .type-btn#btnQuick.active { border-color: var(--accent-secondary); color: var(--accent-secondary); background: rgba(235, 203, 139, 0.1); }
        
        .input-group { margin-bottom: 15px; text-align: left; }
        label { display: block; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 6px; font-family: 'JetBrains Mono', monospace; }
        input, select { width: 100%; background: var(--bg-input); border: 1px solid transparent; color: white; padding: 12px; border-radius: 6px; outline: none; transition: 0.2s; }
        input:focus, select:focus { border-color: var(--accent-primary); background: #4c566a; }
        input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; }
        .add-btn { margin-top: 10px; width: 100%; padding: 14px; background: var(--accent-primary); color: #2e3440; font-weight: 700; border: none; border-radius: var(--border-radius); cursor: pointer; transition: 0.2s; }
        #scheduledInputs { display: none; }

        .main-content { display: flex; flex-direction: column; gap: 20px; height: 100%; overflow: hidden; min-height: 0; }
        .box-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 15px; border-bottom: 2px solid var(--bg-body); margin-bottom: 10px; flex-shrink: 0; }
        .box-title { font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .clear-btn { background: transparent; border: none; color: var(--accent-danger); font-size: 0.8rem; cursor: pointer; opacity: 0.6; }
        .clear-btn:hover { opacity: 1; }
        .task-list { overflow-y: auto; padding-right: 5px; flex-grow: 1; min-height: 0; }
        .task-list::-webkit-scrollbar { width: 5px; }
        .task-list::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 10px; }
        .quick-box { display: flex; flex-direction: column; border-top: 3px solid var(--accent-secondary); height: 35%; min-height: 200px; }
        .scheduled-box { display: flex; flex-direction: column; border-top: 3px solid var(--accent-primary); flex-grow: 1; min-height: 0; }
        .task-item { background: var(--bg-input); margin-bottom: 8px; padding: 12px 16px; border-radius: 6px; display: flex; align-items: center; gap: 12px; flex-shrink: 0; }
        .task-item.completed { opacity: 0.5; text-decoration: line-through; }
        .check-box { width: 20px; height: 20px; border: 2px solid var(--text-muted); border-radius: 4px; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0; }
        .task-content { flex: 1; }
        .task-meta { display: flex; gap: 10px; margin-top: 4px; font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; }
        .meta-High { color: var(--accent-danger); } .meta-Medium { color: var(--accent-secondary); } .meta-Low { color: var(--accent-success); }
        .delete-btn { background: transparent; border: none; color: var(--text-muted); cursor: pointer; padding: 5px; }
        .delete-btn:hover { color: var(--accent-danger); }
        .date-sep { font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--accent-primary); margin: 15px 0 8px; opacity: 0.8; flex-shrink: 0; }
        .dev-footer { text-align: center; font-size: 0.75rem; color: var(--text-muted); font-family: 'JetBrains Mono', monospace; margin-top: auto; opacity: 0.6; letter-spacing: 0.5px; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="alertModal" class="overlay" style="display:none;">
        <div class="modal-box">
            <div class="modal-title" id="alertTitle">Notification</div>
            <div class="modal-sub" id="alertMsg">Message goes here</div>
            <button class="modal-btn btn-primary" onclick="closeAlert()">Okay</button>
        </div>
    </div>

    <div id="confirmModal" class="overlay" style="display:none;">
        <div class="modal-box">
            <div class="modal-title" id="confirmTitle">Confirm Action</div>
            <div class="modal-sub" id="confirmMsg">Are you sure?</div>
            <div class="btn-row">
                <button class="modal-btn btn-secondary" onclick="closeConfirm()">Cancel</button>
                <button class="modal-btn btn-danger" id="confirmYesBtn">Yes, Proceed</button>
            </div>
        </div>
    </div>

    <div id="loginOverlay" class="overlay">
        <div class="modal-box">
            <div class="modal-title">Secure Access</div>
            <div class="modal-sub">Enter your codename & password</div>
            <div class="input-group"><input type="text" id="loginNameInput" placeholder="> Codename" autocomplete="off"></div>
            <div class="input-group"><input type="password" id="loginPassInput" placeholder="> Password" autocomplete="off"></div>
            <button class="add-btn" id="loginBtn">Login / Register</button>
            <div style="font-size:0.7rem; color:#94a3b8; margin-top:10px;">(New user? Enter a password to register)</div>
        </div>
    </div>

    <div id="passOverlay" class="overlay" style="display:none;">
        <div class="modal-box">
            <button class="close-modal" onclick="closePassModal()"><i class="ph-bold ph-x"></i></button>
            <div class="modal-title">Change Password</div>
            <div class="modal-sub">Update credentials for security</div>
            <div class="input-group"><input type="password" id="oldPassInput" placeholder="> Current Password" autocomplete="off"></div>
            <div class="input-group"><input type="password" id="newPassInput" placeholder="> New Password" autocomplete="off"></div>
            <button class="add-btn" id="changePassBtn">Update Password</button>
        </div>
    </div>

    <div class="app-container" id="appContainer">
        <aside class="dev-card sidebar">
            <div class="user-section">
                <div class="greeting-row">
                    <div style="display:flex; align-items:center; gap:6px;">
                        <span>Hello,</span>
                        <span id="userName" class="user-name">Dev</span>
                    </div>
                    <div style="position:relative;">
                        <button id="menuTrigger" class="menu-btn"><i class="ph-bold ph-list"></i></button>
                        <div id="menuDropdown" class="dropdown-menu">
                            <button class="menu-item" onclick="openPassModal()"><i class="ph-bold ph-lock-key"></i> Change Pass</button>
                            <button class="menu-item" onclick="shareApp()"><i class="ph-bold ph-share-network"></i> Share App</button>
                            <button class="menu-item" onclick="logout()"><i class="ph-bold ph-sign-out"></i> Logout</button>
                        </div>
                    </div>
                </div>
                <div class="welcome-sub" id="typewriterText">welcome back!</div>
            </div>

            <div class="toggle-group">
                <button class="type-btn active" id="btnQuick">Quick</button>
                <button class="type-btn" id="btnSched">Scheduled</button>
            </div>
            <div class="input-group">
                <label>TASK DESCRIPTION</label>
                <input type="text" id="taskInput" placeholder="> Type here..." autocomplete="off">
            </div>
            <div id="scheduledInputs">
                <div class="input-group"><label>TARGET DATE</label><input type="date" id="dateInput"></div>
                <div class="input-group"><label>PRIORITY</label>
                    <select id="priorityInput">
                        <option value="High">High (Urgent)</option>
                        <option value="Medium" selected>Medium</option>
                        <option value="Low">Low</option>
                    </select>
                </div>
            </div>
            <button class="add-btn" id="commitBtn">COMMIT TASK</button>
        </aside>

        <main class="main-content">
            <div class="dev-card quick-box">
                <div class="box-header">
                    <div class="box-title" style="color: var(--accent-secondary)"><i class="ph-fill ph-lightning"></i> Quick Notes</div>
                    <button class="clear-btn" id="clearQuick">Clear All</button>
                </div>
                <div id="quickList" class="task-list"></div>
            </div>
            <div class="dev-card scheduled-box">
                <div class="box-header">
                    <div class="box-title" style="color: var(--accent-primary)"><i class="ph-fill ph-calendar-check"></i> Scheduled Plan</div>
                    <button class="clear-btn" id="clearSched">Clear All</button>
                </div>
                <div id="scheduledList" class="task-list"></div>
            </div>
            <div class="dev-footer">&copy; Developed by Promis Vora</div>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove, update, get, set, child } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDJiG6SkXmj_ofDuYiIRf8D5H6kyNvuhho",
            authDomain: "to-do-promise.firebaseapp.com",
            projectId: "to-do-promise",
            storageBucket: "to-do-promise.firebasestorage.app",
            messagingSenderId: "1033945661048",
            appId: "1:1033945661048:web:859e70fe1788ccd989b78d",
            measurementId: "G-EPWPC7CQNW",
            databaseURL: "https://to-do-promise-default-rtdb.firebaseio.com"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        
        let tasksRef;
        let tasks = [];
        let mode = 'quick';
        let currentUser = '';
        const STORAGE_KEY_USER = 'devTask_user_secure';

        // --- CUSTOM ALERT/CONFIRM ---
        window.customAlert = (msg, title = "Notification") => {
            document.getElementById('alertTitle').innerText = title;
            document.getElementById('alertMsg').innerText = msg;
            document.getElementById('alertModal').style.display = 'flex';
        }
        window.closeAlert = () => document.getElementById('alertModal').style.display = 'none';

        window.customConfirm = (msg, callback, title = "Confirm Action") => {
            document.getElementById('confirmTitle').innerText = title;
            document.getElementById('confirmMsg').innerText = msg;
            document.getElementById('confirmModal').style.display = 'flex';
            
            const yesBtn = document.getElementById('confirmYesBtn');
            const newBtn = yesBtn.cloneNode(true);
            yesBtn.parentNode.replaceChild(newBtn, yesBtn);
            
            newBtn.addEventListener('click', () => { callback(); closeConfirm(); });
        }
        window.closeConfirm = () => document.getElementById('confirmModal').style.display = 'none';


        // --- MENU LOGIC ---
        const menuBtn = document.getElementById('menuTrigger');
        const dropdown = document.getElementById('menuDropdown');
        menuBtn.addEventListener('click', (e) => { e.stopPropagation(); dropdown.classList.toggle('show'); menuBtn.classList.toggle('active'); });
        document.addEventListener('click', (e) => {
            if (!menuBtn.contains(e.target) && !dropdown.contains(e.target)) { dropdown.classList.remove('show'); menuBtn.classList.remove('active'); }
        });

        window.openPassModal = () => { document.getElementById('passOverlay').style.display = 'flex'; dropdown.classList.remove('show'); }
        window.closePassModal = () => {
            document.getElementById('passOverlay').style.display = 'none';
            document.getElementById('oldPassInput').value = ''; document.getElementById('newPassInput').value = '';
        }
        window.shareApp = () => {
            const url = window.location.href;
            if (navigator.share) navigator.share({ title: 'DevTask', text: "Check out my Task Manager!", url: url }).catch(console.error);
            else { navigator.clipboard.writeText(url); customAlert("Link copied to clipboard!"); }
            dropdown.classList.remove('show');
        }
        window.logout = () => {
            customConfirm("Are you sure you want to sign out?", () => {
                localStorage.removeItem(STORAGE_KEY_USER); location.reload();
            }, "Sign Out");
        }

        // --- FIREBASE INIT ---
        function initFirebaseForUser(userName) {
            currentUser = userName;
            tasksRef = ref(db, 'tasks/' + userName);
            onValue(tasksRef, (snapshot) => {
                tasks = []; const data = snapshot.val();
                if(data) Object.keys(data).forEach(key => tasks.push({ id: key, ...data[key] }));
                render();
            });
            
            // RESTART TYPEWRITER ANIMATION ON LOGIN
            const tw = document.getElementById('typewriterText');
            tw.style.animation = 'none';
            tw.offsetHeight; /* trigger reflow */
            tw.style.animation = null; 
        }

        // --- AUTH LOGIC ---
        async function submitLogin() {
            const rawName = document.getElementById('loginNameInput').value.trim();
            const password = document.getElementById('loginPassInput').value.trim();
            const name = rawName.replace(/[^a-zA-Z0-9]/g, ""); 
            if(!name || !password) return customAlert("Username and Password are required!", "Error");

            const loginBtn = document.getElementById('loginBtn');
            loginBtn.innerText = "Verifying...";
            
            try {
                const snapshot = await get(child(ref(db), `credentials/${name}`));
                if (snapshot.exists()) {
                    if (snapshot.val() === password) loginSuccess(name);
                    else { customAlert("❌ Incorrect Password", "Access Denied"); loginBtn.innerText = "Login / Register"; }
                } else {
                    customConfirm(`User '${name}' not found. Create new account?`, async () => {
                        await set(ref(db, 'credentials/' + name), password);
                        customAlert("✅ Account Created!", "Success");
                        loginSuccess(name);
                    }, "Create Account");
                    loginBtn.innerText = "Login / Register";
                }
            } catch (error) { console.error(error); customAlert("Network Error", "Error"); loginBtn.innerText = "Login / Register"; }
        }

        function loginSuccess(name) {
            localStorage.setItem(STORAGE_KEY_USER, name);
            document.getElementById('userName').innerText = name;
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('appContainer').style.opacity = '1';
            initFirebaseForUser(name);
        }

        document.getElementById('changePassBtn').addEventListener('click', async () => {
            const oldPass = document.getElementById('oldPassInput').value.trim();
            const newPass = document.getElementById('newPassInput').value.trim();
            if(!oldPass || !newPass) return customAlert("Fill all fields!", "Error");
            try {
                const snapshot = await get(child(ref(db), `credentials/${currentUser}`));
                if(snapshot.val() === oldPass) {
                    await set(ref(db, `credentials/${currentUser}`), newPass);
                    customAlert("✅ Password Updated Successfully!", "Success"); window.closePassModal();
                } else customAlert("❌ Old Password is Wrong!", "Error");
            } catch(e) { customAlert("Error updating password.", "Error"); }
        });

        function checkAutoLogin() {
            const savedUser = localStorage.getItem(STORAGE_KEY_USER);
            if (savedUser) {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('appContainer').style.opacity = '1';
                document.getElementById('userName').innerText = savedUser;
                initFirebaseForUser(savedUser);
            } else document.getElementById('loginNameInput').focus();
        }

        // --- TASK LOGIC ---
        function addTask() {
            if(!currentUser) return;
            const text = document.getElementById('taskInput').value.trim();
            if(!text) return;
            const newTask = { text: text, type: mode, completed: false, timestamp: Date.now() };
            if(mode === 'scheduled') {
                const date = document.getElementById('dateInput').value;
                if(!date) return customAlert("Date required for scheduled task", "Missing Info");
                newTask.date = date; newTask.priority = document.getElementById('priorityInput').value;
            }
            push(tasksRef, newTask); document.getElementById('taskInput').value = '';
        }

        window.toggleTask = (id, currentStatus) => update(ref(db, `tasks/${currentUser}/${id}`), { completed: !currentStatus });
        window.removeTask = (id) => remove(ref(db, `tasks/${currentUser}/${id}`));
        window.clearGroup = (type) => {
            customConfirm(`Delete all ${type} tasks? This cannot be undone.`, () => {
                tasks.filter(t => t.type === type).forEach(t => remove(ref(db, `tasks/${currentUser}/${t.id}`)));
            }, "Clear List");
        }

        // --- RENDER ---
        function toggleMode(newMode) {
            mode = newMode;
            document.getElementById('btnQuick').classList.toggle('active', mode === 'quick');
            document.getElementById('btnSched').classList.toggle('active', mode === 'scheduled');
            document.getElementById('scheduledInputs').style.display = mode === 'quick' ? 'none' : 'block';
            document.getElementById('taskInput').placeholder = mode === 'quick' ? "> Quick note..." : "> Scheduled task...";
        }

        function render() {
            const qList = document.getElementById('quickList'); const sList = document.getElementById('scheduledList');
            qList.innerHTML = ''; sList.innerHTML = '';
            const quicks = tasks.filter(t => t.type === 'quick'); const scheds = tasks.filter(t => t.type === 'scheduled');

            if(!quicks.length) qList.innerHTML = `<div style="color:#4c566a; text-align:center; padding:10px;">// No quick notes</div>`;
            quicks.forEach(t => qList.innerHTML += createHTML(t));

            if(!scheds.length) sList.innerHTML = `<div style="color:#4c566a; text-align:center; padding:10px;">// No scheduled tasks</div>`;
            scheds.sort((a,b) => new Date(a.date) - new Date(b.date) || (a.priority===b.priority?0:a.priority==='High'?-1:1));
            let lastDate = '';
            scheds.forEach(t => {
                if(t.date !== lastDate) {
                    const d = new Date(t.date).toLocaleDateString('en-GB', {day:'numeric', month:'short', year:'numeric'});
                    sList.innerHTML += `<div class="date-sep"># ${d}</div>`; lastDate = t.date;
                }
                sList.innerHTML += createHTML(t);
            });
        }

        function createHTML(t) {
            return `
                <div class="task-item ${t.completed ? 'completed' : ''}">
                    <div class="check-box" onclick="toggleTask('${t.id}', ${t.completed})">${t.completed ? '<i class="ph-bold ph-check"></i>' : ''}</div>
                    <div class="task-content">
                        <div class="task-text">${t.text}</div>
                        ${t.type === 'scheduled' ? `<div class="task-meta"><span class="meta-${t.priority}">[${t.priority}]</span></div>` : ''}
                    </div>
                    <button class="delete-btn" onclick="removeTask('${t.id}')"><i class="ph-bold ph-trash"></i></button>
                </div>`;
        }

        // --- EVENTS ---
        document.getElementById('btnQuick').addEventListener('click', () => toggleMode('quick'));
        document.getElementById('btnSched').addEventListener('click', () => toggleMode('scheduled'));
        document.getElementById('commitBtn').addEventListener('click', addTask);
        document.getElementById('taskInput').addEventListener('keypress', (e) => { if(e.key === 'Enter') addTask(); });
        document.getElementById('clearQuick').addEventListener('click', () => clearGroup('quick'));
        document.getElementById('clearSched').addEventListener('click', () => clearGroup('scheduled'));
        document.getElementById('loginBtn').addEventListener('click', submitLogin);
        document.getElementById('loginPassInput').addEventListener('keypress', (e) => { if(e.key==='Enter') submitLogin() });

        document.getElementById('dateInput').valueAsDate = new Date();
        checkAutoLogin();
    </script>
</body>
</html>